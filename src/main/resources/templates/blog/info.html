<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Newtol_博客详情页</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>

  <!--引入样式文件-->
  <link rel="stylesheet" href="../../static/editor/css/editormd.preview.css" />
  <!--引入js文件-->
  <script src="../../static/editor/js/editor/jquery.min.js"></script>
  <script src="../../static/editor/js/editor/marked.min.js"></script>
  <script src="../../static/editor/js/editor/prettify.min.js"></script>
  <script src="../../static/editor/js/editor/raphael.min.js"></script>
  <script src="../../static/editor/js/editor/underscore.min.js"></script>
  <script src="../../static/editor/js/editor/sequence-diagram.min.js"></script>
  <script src="../../static/editor/js/editor/flowchart.min.js"></script>
  <script src="../../static/editor/js/editor/jquery.flowchart.min.js"></script>
  <script src="../../static/editor/js/editor/editormd.js"></script>

  <script src="../../static/blog/js/myJs.js"></script>
  <script src="../../static/blog/js/info.js"></script>
  <script src="../../static/blog/js/mumu.js"></script>
  <script src="../../static/blog/js/safe.js"></script>
  <!--<script src="../../static/blog/js/safe.js"></script>-->
  <link rel="shortcut icon" href="../../static/favicon.ico" type="image/x-icon" />
  <script src="../../static/blog/js/mouse.js"></script>
  <link href="../../static/blog/css/base.css" rel="stylesheet">
  <link href="../../static/blog/css/index.css" rel="stylesheet">
  <link href="../../static/blog/css/info.css" rel="stylesheet">
  <link href="../../static/blog/css/m.css" rel="stylesheet">
  <script src="../../static/blog/js/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript" src="../../static/blog/js/comm.js"></script>
<!--[if lt IE 9]>
<script src="../../static/blog/js/modernizr.js"></script>
<![endif]-->
</head>
<style>
  .content{width:80%;margin:10px auto;}
  .hide_box{z-index:999;filter:alpha(opacity=50);background:#666;opacity: 0.5;-moz-opacity: 0.5;left:0;top:0;height:99%;width:100%;position:fixed;display:none;}
  .shang_box{width:540px;height:540px;padding:10px;background-color:#fff;border-radius:10px;position:fixed;z-index:1000;left:50%;top:50%;margin-left:-280px;margin-top:-280px;border:1px dotted #dedede;display:none;}
  .shang_box img{border:none;border-width:0;}
  .dashang{display:block;width:100px;margin:5px auto;height:25px;line-height:25px;padding:10px;background-color:#E74851;color:#fff;text-align:center;text-decoration:none;border-radius:10px;font-weight:bold;font-size:16px;transition: all 0.3s;}
  .dashang:hover{opacity:0.8;padding:15px;font-size:18px;}
  .shang_close{float:right;display:inline-block;}
  .shang_logo{display:block;text-align:center;margin:20px auto;}
  .shang_tit{width: 100%;height: 75px;text-align: center;line-height: 66px;color: #a3a3a3;font-size: 16px;background: url('/dsimg/cy-reward-title-bg.jpg');font-family: 'Microsoft YaHei';margin-top: 7px;margin-right:2px;}
  .shang_tit p{color:#a3a3a3;text-align:center;font-size:16px;}
  .shang_payimg{width:140px;padding:10px;border:6px solid #EA5F00;margin:0 auto;border-radius:3px;height:140px;}
  .shang_payimg img{display:block;text-align:center;width:140px;height:140px; }
  .pay_explain{text-align:center;margin:10px auto;font-size:12px;color:#545454;}
  .radiobox{width: 16px;height: 16px;background: url('https://static.runoob.com/images/dashang/radio2.jpg');display: block;float: left;margin-top: 5px;margin-right: 14px;}
  .checked .radiobox{background:url('https://static.runoob.com/images/dashang/radio1.jpg');}
  .shang_payselect{text-align:center;margin:0 auto;margin-top:40px;cursor:pointer;height:60px;width:280px;}
  .shang_payselect .pay_item{display:inline-block;margin-right:10px;float:left;}
  .shang_info{clear:both;}
  .shang_info p,.shang_info a{color:#C3C3C3;text-align:center;font-size:12px;text-decoration:none;line-height:2em;}
</style>
<body>
<header class="header-navigation" id="header">
  <nav>
    <div class="logo"><a href="/">程序猿Newtol</a></div>
    <h2 id="mnavh"><span class="navicon"></span></h2>
    <ul id="starlist">
      <li><a href="/index">文章</a></li>
      <li><a href="/about">关于我</a></li>
      <li><a href="/share">时间轴</a></li>
      <li><a href="/game">开放API</a></li>
<!--      <li><a href="/gbook">联系我</a></li>-->
      <li><a href="/editor">md在线编辑器</a></li>
    </ul>
  </nav>
</header>
<article>
  <aside class="l_box">
    <div class="guanzhu">
      <h2>关注我 有惊喜</h2>
      <ul>
        <img src="../../static/blog/images/wx.jpg">
      </ul>
    </div>
    <div class="fenlei">
      <h2>文章分类</h2>
      <ul id="contentType">
      </ul>
    </div>
    <div class="tuijian">
      <h2>站长推荐</h2>
      <ul id="recommandationList"></ul>
    </div>
    <div class="tuijian">
      <h2>阅读排行</h2>
      <ul id="readRankList"></ul>
    </div>
    <div class="cloud">
      <h2>联系我</h2>
      <ul id="keyWord"></ul>
    </div>
  </aside>
  <main>
    <div class="infosbox" >
      <div class="newsview">
        <h3 class="news_title"></h3>
        <div class="bloginfo">
          <ul id="contentinfo">
            <li class="author"></li>
            <li class="timer"></li>
            <li class="view"></li>
          </ul>
        </div>
        <div class="tags"></div>
        <div class="news_about"><strong>简介</strong></div>
        <div class="news_con">
          <div id="testEditorMdview"></div>
        </div>
      </div>
      <div class="share">
        <p class="diggit" style="cursor: pointer" onclick="addPraise();"></p>
        <div class="hide_box"></div>
        <div class="shang_box">
          <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()" title="关闭"><img src="https://static.runoob.com/images/dashang/close.jpg" alt="取消" /></a>
          <div class="shang_tit">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="shang_payimg">
            <img src="../../static/blog/images/alipay.jpg" alt="扫码支持" title="扫一扫" />
          </div>
          <div class="pay_explain">扫码打赏，你说多少就多少</div>
          <div class="shang_payselect">
            <div class="pay_item checked" data-id="alipay">
              <span class="radiobox"></span>
              <span class="pay_logo"><img src="../../static/blog/images/ali.jpg" alt="支付宝" /></span>
            </div>
            <div class="pay_item" data-id="weipay">
              <span class="radiobox"></span>
              <span class="pay_logo"><img src="../../static/blog/images/wechat.jpg" alt="微信" /></span>
            </div>
          </div>
          <div class="shang_info">
            <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
          </div>
        </div>
      </div>

      <div class="nextinfo">
        <p id="nextContent">上一篇：无</p>
        <p id="previousContent">下一篇：无</p>
      </div>
      <div class="news_pl">
        <h2>文章评论</h2>
        <div class="gbko">
        </div>
        <div>
          <p id="0"><a class="saying" name= "0"  onclick="display(this);"><strong>你也来说两句吧（点击此处回复）...</strong></a></p>
        </div>
      </div>
    </div>
  </main>
  <div >
    <form id="replyForm" style="width:90%;display: none;margin: auto" name="replyForm" >
        <p class="yname"><span>邮箱:</span>
          <label >
            <input name="fromId" type="text" placeholder="请输入邮箱" class="inputText" id="fromId"  size="16">*
          </label>
        </p>
        <p class="yzm"><span>验证码:</span>
          <label>
            <input name="validCode" placeholder="请输入验证码" type="text" class="inputText" size="16">*
            <img style="width: 95px;height: 25px;display: block;float: right" id = "validCode" src="../validCodeImg/1" onclick="changeCode();">
          </label>
        </p>
        <input name="pId" type="hidden" id="pId" >
        <label >
          <textarea placeholder="欢迎留言，字数最多200字" name="message" rows="6" id="saytext" style="resize: none"></textarea>
        </label>
        <input type="button" value="评论" class="btn2" onclick = "saveMsg();" style="width: 100px;height: 40px;" />
        <input name="toId" type="hidden" id="toId" >
        <input name="contentId" type="hidden" id="contentId" >
    </form>
  </div>
</article>
<footer>
  <div id="spig" class="spig" onclick="getSoup();">
    <div id="message">点我有惊喜</div>
    <div id="mumu" class="mumu" onclick=""></div>
  </div>
  <p><strong>版权所有：<a href="/index" target="_blank">程序猿Newtol</a> <a href="/">黔ICP备17003873号</a></strong></p>
  <p><strong>版权声明：本文为博主原创文章，著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处，附上博文链接！</strong></p>

</footer>
<a href="#" class="cd-top">Top</a>
</body>

<script type="text/javascript">

    $(function () {
      getMsgByContentId();
    });

    $(function(){
        $(".pay_item").click(function(){
            $(this).addClass('checked').siblings('.pay_item').removeClass('checked');
            var dataid=$(this).attr('data-id');
            $(".shang_payimg img").attr("src","../../static/blog/images/"+dataid+".jpg");
            $("#shang_pay_txt").text(dataid=="alipay"?"支付宝":"微信");
        });
    });

    function dashangToggle(){
        $(".hide_box").fadeToggle();
        $(".shang_box").fadeToggle();
    }

    window.onload=getWeather();

    // 动态更换页面title
    window.onload = changeTitle();

    // 增加鼠标点击特效
    onload = myMouse();

    // 获取评论
   function getMsgByContentId() {
      var msgList;
      $.ajax({
          url:"../msg?contentId="+contentId,
          dataType:'json',
          async: false,
          success:function(json){
             msgList = json.data;
          }
      });
      if(msgList.length>0){
          for(var i in msgList){
              var a ="<a style='display:block;font-size:14px;text-align:right;font-weight:400;' name ='"+msgList[i].msgId+"' fromId='"+msgList[i].fromId+"' onclick='display(this)'>回复</a>";
              var time ="<span style='display: block;float: right'>"+msgList[i].createTime+"</span>";
              var  p1= "<p class='btime'>"+time+msgList[i].fromId+"</p>";
              var p2 = "<p class='fbinfo'>"+msgList[i].message+"</p>";
              $(".gbko").append("<div class=\"fb\" id='"+msgList[i].msgId+"'><ul>" +p1+p2+a+"</ul></div>");
              getDiscuss(msgList[i].msgId);
          }
      }
  }
  // 判断是否已经展示form表单
  var Key;
  function display(obj) {
      var id = obj.name;
      if(Key===obj.name && document.getElementById('replyForm').style.display ===""){
          document.getElementById('replyForm').style.display ="none"
      }else {
          document.getElementById('replyForm').style.display ="";
          $("#replyForm").appendTo(document.getElementById(id));
          document.getElementById("pId").value =id;
          document.getElementById("toId").value = obj.getAttribute("fromId");
          Key = obj.name;
      }
  }

  // 保存二级评论
  function saveMsg() {
      changeCode();
      if(!CheckPl()){
          return;
      }
      document.getElementById("contentId").value = getContentId();
      $.ajax({
          type: 'POST',
          url:"../msg",
          dataType:'json',
          async: false,
          data:$("#replyForm").serialize(),
          success:function(json){
              var data = json.data; 2
              if(json.errorCode===0){
                  alert("已经收到你的评论啦！");
                  $("#replyForm").remove();
                  window.location.reload();
              }else {
                  alert(json.errorMsg);
              }
          }
      });
  }
  // 评论完整度检测
  function CheckPl(){
      var obj = document.replyForm;
      // 检验邮箱是否为邮箱
      var reg = /^\w+((.\w+)|(-\w+))@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/;

      if(obj.fromId.value==""){
          alert("邮箱不可为空");
          obj.fromId.focus();
          return false;
      }else if(!reg.test(obj.fromId.value)){
          alert("邮箱格式不正确");
          return false;
      }
      // 检验是否有输入留言
      if(obj.saytext.value=="")
      {
          alert("您没什么话要说吗？");
          obj.saytext.focus();
          return false;
      }
      // 设置被评论的文章
      return true;
  }
  // 生成二级评论节点
  function createMsgNode(data) {
      var time ="<span style='float: right' >"+data.createTime+"</span>";
      $("<div class='ecomment' style='width: 90%;display: block;margin: auto;background-color: #efefef'><span class=\"ecommentauthor\">"+data.fromId+"回复 :"+data.toId+time+"</span>" + "<p class=\"ecommenttext\">"+data.message+"</p>" + "</div>").appendTo(document.getElementById(data.pid));

  }
  // 获取二级评论
  function getDiscuss(pId) {
      var discussList;
      $.ajax({
          url:"../msg2?pId="+pId,
          dataType:'json',
          async: false,
          success:function(json){
              discussList = json.data;
          }
      });
      if(discussList.length>0){
          for(var i in discussList){
              createMsgNode(discussList[i]);
          }
      }
  }
  // 刷新验证码
  function changeCode() {
      document.getElementById("validCode").src ="/validCodeImg/"+Math.random();
  }

  // 点赞
  function addPraise() {
      var diggit;
      $.ajax({
          type: 'POST',
          url:"/blog/praise",
          dataType:'json',
          async: false,
          data:{"contentId":contentId},
          success:function(json){
              if(json.errorCode===0){
                  diggit = json.data;
                  var msg = confirm("感谢您的支持,是否愿意进行打赏？");
                  if(msg){
                      dashangToggle();
                  }
                  $(".diggit").html("赞："+diggit);
              }else {
                  var msg = confirm(json.errorMsg + "，是否愿意进行打赏？");
                  if(msg){
                      dashangToggle();
                  }

              }
          }
      });
  }
</script>
</html>
