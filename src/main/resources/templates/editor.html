<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <title>Newtol</title>
    <link rel="stylesheet" href="../static/css/style.css" />
    <link rel="stylesheet" href="../static/css/editormd.css" />
    <link rel="shortcut icon" href="https://pandao.github.io/editor.md/favicon.ico" type="image/x-icon" />


</head>

<style>
    #loading{
        position:fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        z-index:300;
        background-image:url("../static/images/loading.gif");
        background-repeat:no-repeat;
        background-position:center center;
        background-color:#000;
        background-color:rgba(0,0,0,0.5);
        filter:alpha(opacity=50);
    }
</style>
<body>
<div id="layout">
    <form name="myForm" id = "myForm"method="post" action="http://localhost:9090/editor/myResume">
        <div style="width:90%;margin: 10px auto;">
            <input type="text"  name="title" placeholder="请输入标题" style="width: 85%;padding: 6px;border-radius: 4px">
            <select name="resumeType" id = "resumeType" style="width: 10%;border-radius: 4px;padding: 6px">
            </select>
            <input type="button" value="下载" onclick="downloadPdf()"  style="width: 10%;padding: 5px;background-color: #FFF0F5;border-radius: 8px;">
        </div>
        <div id="editor-md"  style="width: 90%; height: 640px;"  >
            <textarea style="display:none;" name="content" id="content"></textarea>
        </div>
    </form>
</div>
<div id="loading">文件转换中</div>

<script src="../static/js/editor/jquery.min.js"></script>
<script src="../static/js/editor/editormd.min.js"></script>
<script>

</script>
<script type="text/javascript">
    var testEditor;
    var result = "niaho";
    // 加载模板简历类型
    $(function () {
        $.ajax({
            url:'/resumeTemplate/lists',
            dataType:'json',
            async: false,
            success:function(json){
                var sl = document.getElementById("resumeType");
                var b = json.data;
                for (var i in b) {
                    sl.options.add(new Option(b[i].resume_type,b[i].resume_id));
                }
            }
        });
    })

    //  加载编辑器
    $(function() {
        getTemplate();
        // 当选择模板简历后，重新加载编辑器
        $("#resumeType").change(function(){
            getTemplate();
        });
        
        function getTemplate() {
            var resumeId=$("#resumeType").val();
            $.ajax({
                url:'http://localhost:9090/editor/getTemplateResume/'+resumeId,
                dataType:'json',
                async: false,
                success:function(json){
                    result=json.data;
                }
            });
            testEditor = editormd("editor-md", {
                width   : "90%",
                height  : 640,
                syncScrolling : "single",
                path    : "../static/lib/",
                onload : function() {
                    $("#loading").remove();
                    this.setMarkdown(result);

                }
            });
        }

    });
    //    下载pdf
    function downloadPdf() {
        $.ajax({
            //几个参数需要注意一下
            type: "POST",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "http://localhost:9090/editor/myResume" ,//url
            data: $('#myForm').serialize(),
            beforeSend:function(){
                $("<div id=\"loading\"></div>").appendTo("body");
            },
            success: function (result) {
                $("#loading").remove();
                if(result.errorCode === 0){
                    window.location.href=result.data;
                }else {
                    alert(result.errorMsg);
                }
            },
            error : function() {
                alert("服务器繁忙，请稍后再试！");
            }
        });
    }
</script>
</body>
</html>


